<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Janashakthi Financial Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .spin {
            animation: spin 1s linear infinite;
        }

        .kpi-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(226, 232, 240, 0.5);
            backdrop-filter: blur(10px);
        }

        .kpi-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.5);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .auth-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(226, 232, 240, 0.5);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .auth-input {
            transition: all 0.2s ease;
        }

        .auth-input:focus {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }

        .kpi-value {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            background: linear-gradient(135deg, #1e293b 0%, #475569 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .kpi-unit {
            font-size: 0.75rem;
            font-weight: 600;
            color: #64748b;
            opacity: 0.8;
        }

        .kpi-budget {
            font-size: 0.875rem;
            font-weight: 500;
            color: #94a3b8;
        }

        .kpi-icon {
            background: linear-gradient(135deg, var(--icon-color, #3b82f6), var(--icon-color-light, #60a5fa));
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .nav-item {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-item:hover {
            transform: translateX(4px);
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            transform: translateY(-1px);
            box-shadow: 0 8px 15px rgba(59, 130, 246, 0.3);
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <div style="text-align: center; color: white;">
                <div style="width: 64px; height: 64px; border: 4px solid #ffffff; border-top: 4px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px;"></div>
                 <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 8px;">Loading Janashakthi Dashboard</h2>
                <p style="opacity: 0.8;">Initializing secure authentication...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // Authentication context
        function useAuth() {
            const [authState, setAuthState] = useState({
                isLoading: true,
                isAuthenticated: false,
                user: null,
                requiresSetup: false,
                requiresLogin: false
            });

            const checkAuthStatus = async () => {
                try {
                    const token = localStorage.getItem('authToken');
                    const response = await fetch('/api/auth/status', {
                        headers: token ? { 'Authorization': `Bearer ${token}` } : {}
                    });
                    const data = await response.json();
                    if (data.requiresSetup) {
                        setAuthState({ isLoading: false, requiresSetup: true, isAuthenticated: false });
                    } else if (data.requiresLogin) {
                        setAuthState({ isLoading: false, requiresLogin: true, isAuthenticated: false });
                    } else if (data.authenticated) {
                        setAuthState({ 
                            isLoading: false, 
                            isAuthenticated: true, 
                            user: data.user 
                        });
                    }
                } catch (error) {
                    console.error('Auth status check failed:', error);
                    setAuthState({ isLoading: false, requiresLogin: true, isAuthenticated: false });
                }
            };

            const login = async (email, password) => {
                try {
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password })
                    });
                    const data = await response.json();
                    if (response.ok) {
                        localStorage.setItem('authToken', data.token);
                        setAuthState({ 
                            isLoading: false, 
                            isAuthenticated: true, 
                            user: data.user 
                        });
                        return { success: true, message: data.message };
                    } else {
                        return { success: false, message: data.error };
                    }
                } catch (error) {
                    return { success: false, message: 'Login failed. Please try again.' };
                }
            };
            const register = async (email, password, name) => {
                try {
                    const response = await fetch('/api/auth/register', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, password, name })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        localStorage.setItem('authToken', data.token);
                        setAuthState({ 
                            isLoading: false, 
                            isAuthenticated: true, 
                            user: data.user 
                        });
                        return { success: true, message: data.message };
                    } else {
                        return { success: false, message: data.error };
                    }
                } catch (error) {
                    return { success: false, message: 'Registration failed. Please try again.' };
                }
            };
            const logout = () => {
                localStorage.removeItem('authToken');
                setAuthState({ 
                    isLoading: false,
                    isAuthenticated: false, 
                    requiresLogin: true
                });
            };
            useEffect(() => {
                checkAuthStatus();
            }, []);
            return { authState, login, register, logout };
        }
        
        // Login/Register Component

        function AuthComponent({ authState, login, register }) {
            const [isLogin, setIsLogin] = useState(!authState.requiresSetup);
            const [formData, setFormData] = useState({ email: '', password: '', name: '' });
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    let result;
                    if (isLogin) {
                        result = await login(formData.email, formData.password);
                    } else {
                        if (!formData.name.trim()) {
                            setError('Name is required');
                            setLoading(false);
                            return;
                        }
                        result = await register(formData.email, formData.password, formData.name);
                    }
                    if (!result.success) {
                        setError(result.message);
                    }
                } catch (err) {
                    setError('An unexpected error occurred');
                } finally {
                    setLoading(false);
                }
            };
            const handleInputChange = (e) => {
                setFormData(prev => ({
                    ...prev,
                    [e.target.name]: e.target.value
                }));
            };
            return React.createElement('div', {
                className: 'min-h-screen flex items-center justify-center',
                style: { 
                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
                    padding: '1rem'
                }
            }, [
                React.createElement('div', {
                    key: 'auth-card',
                    className: 'auth-card rounded-2xl shadow-2xl p-8 w-full max-w-md'
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: 'text-center mb-8'
                    }, [
                        React.createElement('div', {
                            key: 'logo',
                            className: 'w-16 h-18 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xl mx-auto mb-4'
                        }, 'Janashakthi Limited'),
                        React.createElement('h2', {
                            key: 'title',
                            className: 'text-2xl font-bold text-gray-900 mb-2'
                        }, isLogin ? 'Welcome Back' : (authState.requiresSetup ? 'Setup Admin Account' : 'Create Account')),
                        React.createElement('p', {
                            key: 'subtitle',
                            className: 'text-gray-600'
                        }, isLogin ? 'Sign in to access your dashboard' : (authState.requiresSetup ? 'Create the first admin account' : 'Join the Janashakthi team'))
                    ]),

                    error && React.createElement('div', {
                        key: 'error',
                        className: 'bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6'
                    }, error),

                    React.createElement('form', {
                        key: 'form',
                        onSubmit: handleSubmit,
                        className: 'space-y-6'
                    }, [
                        !isLogin && React.createElement('div', {
                            key: 'name-field'
                        }, [
                            React.createElement('label', {
                                key: 'name-label',
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'Full Name'),
                            React.createElement('input', {
                                key: 'name-input',
                                type: 'text',
                                name: 'name',
                                value: formData.name,
                                onChange: handleInputChange,
                                className: 'auth-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                placeholder: 'Enter your full name',
                                required: !isLogin
                            })
                        ]),

                        React.createElement('div', {
                            key: 'email-field'
                        }, [
                            React.createElement('label', {
                                key: 'email-label',
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'Email Address'),
                            React.createElement('input', {
                                key: 'email-input',
                                type: 'email',
                                name: 'email',
                                value: formData.email,
                                onChange: handleInputChange,
                                className: 'auth-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                placeholder: 'Enter your email',
                                required: true
                            })
                        ]),
                        React.createElement('div', {
                            key: 'password-field'
                        }, [
                            React.createElement('label', {
                                key: 'password-label',
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'Password'),
                            React.createElement('input', {
                                key: 'password-input',
                                type: 'password',
                                name: 'password',
                                value: formData.password,
                                onChange: handleInputChange,
                                className: 'auth-input w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent',
                                placeholder: isLogin ? 'Enter your password' : 'Create a password (min 6 characters)',
                                required: true,
                                minLength: isLogin ? undefined : 6
                            })
                        ]),
                        React.createElement('button', {
                            key: 'submit-btn',
                            type: 'submit',
                            disabled: loading,
                            className: 'btn-primary w-full text-white py-3 px-4 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed'
                        }, loading ? 'Please wait...' : (isLogin ? 'Sign In' : 'Create Account'))
                    ]),
                    !authState.requiresSetup && React.createElement('div', {
                        key: 'toggle',
                        className: 'mt-6 text-center'
                    }, [
                        React.createElement('p', {
                            key: 'toggle-text',
                            className: 'text-gray-600'
                        }, isLogin ? "Don't have an account? " : "Already have an account? "),
                        React.createElement('button', {
                            key: 'toggle-btn',
                            type: 'button',
                            onClick: () => {
                                setIsLogin(!isLogin);
                                setError('');
                                setFormData({ email: '', password: '', name: '' });
                            },
                            className: 'text-blue-600 hover:text-blue-800 font-semibold'
                        }, isLogin ? 'Sign up' : 'Sign in')
                    ])
                ])
            ]);
        }
        
        // User Management Component (Optional)
        function UserManagement({ user, onClose }) {
            const [users, setUsers] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState('');

            const loadUsers = async () => {
                try {
                    const token = localStorage.getItem('authToken');
                    const response = await fetch('/api/admin/users', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        setUsers(data);
                    } else {
                        setError('Failed to load users');
                    }
                } catch (err) {
                    setError('Error loading users');
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                loadUsers();
            }, []);

            return React.createElement('div', {
                className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4'
            }, React.createElement('div', {
                className: 'bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden'
            }, [
                React.createElement('div', {
                    key: 'header',
                    className: 'bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6'
                }, [
                    React.createElement('div', {
                        key: 'header-content',
                        className: 'flex items-center justify-between'
                    }, [
                        React.createElement('h2', {
                            key: 'title',
                            className: 'text-2xl font-bold'
                        }, 'User Management'),
                        React.createElement('button', {
                            key: 'close',
                            onClick: onClose,
                            className: 'text-white hover:text-gray-200 text-2xl font-bold'
                        }, 'Ã—')
                    ])
                ]),
                React.createElement('div', {
                    key: 'content',
                    className: 'p-6'
                }, loading ? 'Loading users...' : error ? error : `${users.length} users registered`)
            ]));
        }

        console.log('Dashboard script starting...');
        
        // Enhanced interactive chart components with better visuals
        function SimpleBarChart({ data, color, hideLegend }) {
            const chartRef = React.useRef(null);
            const chartInstance = React.useRef(null);
            
            React.useEffect(() => {
                if (!data || data.length === 0 || !chartRef.current) return;
                
                // Destroy existing chart
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }
                
                const ctx = chartRef.current.getContext('2d');
                
                // Create gradient
                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, color || '#3B82F6');
                gradient.addColorStop(1, (color || '#3B82F6') + '80');
                
                const budgetGradient = ctx.createLinearGradient(0, 0, 0, 400);
                budgetGradient.addColorStop(0, '#9CA3AF');
                budgetGradient.addColorStop(1, '#9CA3AF60');
                
                chartInstance.current = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.map(item => item.name || item.month),
                        datasets: [
                            {
                                label: 'Actual',
                                data: data.map(item => item.actual || 0),
                                backgroundColor: gradient,
                                borderColor: color || '#3B82F6',
                                borderWidth: 2,
                                borderRadius: 8,
                                borderSkipped: false,
                                barThickness: 40,
                                maxBarThickness: 50,
                                shadowColor: 'rgba(0,0,0,0.1)',
                                shadowBlur: 10,
                                shadowOffsetX: 0,
                                shadowOffsetY: 4,
                            },
                            {
                                label: 'Budget',
                                data: data.map(item => item.budget || 0),
                                backgroundColor: budgetGradient,
                                borderColor: '#6B7280',
                                borderWidth: 2,
                                borderRadius: 8,
                                borderSkipped: false,
                                barThickness: 40,
                                maxBarThickness: 50,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                display: !hideLegend,
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    padding: 25,
                                    font: {
                                        size: 12,
                                        weight: '600'
                                    },
                                    color: '#374151'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: color || '#3B82F6',
                                borderWidth: 2,
                                cornerRadius: 12,
                                displayColors: true,
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 13 },
                                padding: 12,
                                callbacks: {
                                    afterLabel: function(context) {
                                        if (context.datasetIndex === 0 && data[context.dataIndex].budget) {
                                            const actual = data[context.dataIndex].actual || 0;
                                            const budget = data[context.dataIndex].budget;
                                            const variance = ((actual / budget - 1) * 100).toFixed(1);
                                            return `Variance: ${variance}%`;
                                        }
                                        return '';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)',
                                    drawBorder: false,
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    },
                                    color: '#6B7280',
                                    font: { size: 11 }
                                }
                            },
                            x: {
                                grid: {
                                    display: false
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: { size: 11, weight: '500' }
                                }
                            }
                        },
                        animation: {
                            duration: 1500,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
                
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [data, color]);
            
            if (!data || data.length === 0) {
                return React.createElement('div', {
                    className: 'flex items-center justify-center h-full text-gray-500'
                }, 'No data available');
            }
            
            return React.createElement('canvas', {
                ref: chartRef,
                style: { maxHeight: '350px' }
            });
        }

        function SimplePieChart({ data }) {
            const chartRef = React.useRef(null);
            const chartInstance = React.useRef(null);
            
            React.useEffect(() => {
                if (!data || data.length === 0 || !chartRef.current) return;
                
                // Destroy existing chart
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }
                
                const ctx = chartRef.current.getContext('2d');
                
                chartInstance.current = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: data.map(item => item.name || item.month),
                        datasets: [{
                            data: data.map(item => item.value || 0),
                            backgroundColor: data.map(item => item.color || '#3B82F6'),
                            borderColor: '#ffffff',
                            borderWidth: 3,
                            hoverBorderWidth: 4,
                            hoverOffset: 15,
                            spacing: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    usePointStyle: true,
                                    pointStyle: 'circle',
                                    padding: 20,
                                    font: {
                                        size: 12,
                                        weight: '500'
                                    },
                                    color: '#374151',
                                    generateLabels: function(chart) {
                                        const data = chart.data;
                                        const total = data.datasets[0].data.reduce((a, b) => a + b, 0);
                                        
                                        return data.labels.map((label, index) => {
                                            const value = data.datasets[0].data[index];
                                            const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;
                                            
                                            return {
                                                text: `${label}: ${percentage}%`,
                                                fillStyle: data.datasets[0].backgroundColor[index],
                                                strokeStyle: data.datasets[0].backgroundColor[index],
                                                lineWidth: 0,
                                                pointStyle: 'circle',
                                                hidden: false,
                                                index: index
                                            };
                                        });
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderWidth: 2,
                                borderColor: '#3B82F6',
                                cornerRadius: 12,
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 13 },
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = total > 0 ? ((context.raw / total) * 100).toFixed(1) : 0;
                                        return `${context.label}: ${context.raw.toLocaleString()} (${percentage}%)`;
                                    }
                                }
                            }
                        },
                        animation: {
                            animateRotate: true,
                            animateScale: true,
                            duration: 1500,
                            easing: 'easeInOutQuart'
                        },
                        interaction: {
                            intersect: false
                        }
                    }
                });
                
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [data]);
            
            if (!data || data.length === 0) {
                return React.createElement('div', {
                    className: 'flex items-center justify-center h-full text-gray-500'
                }, 'No data available');
            }
            
            return React.createElement('canvas', {
                ref: chartRef,
                style: { maxHeight: '350px' }
            });
        }

        function SimpleLineChart({ data, color }) {
            const chartRef = React.useRef(null);
            const chartInstance = React.useRef(null);
            
            React.useEffect(() => {
                if (!data || data.length === 0 || !chartRef.current) return;
                
                // Destroy existing chart
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }
                
                const ctx = chartRef.current.getContext('2d');
                
                // Create gradient for area fill
                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, (color || '#3B82F6') + '40');
                gradient.addColorStop(1, (color || '#3B82F6') + '05');
                
                const datasets = [
                    {
                        label: 'Actual',
                        data: data.map(item => item.actual || 0),
                        borderColor: color || '#3B82F6',
                        backgroundColor: gradient,
                        borderWidth: 4,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: color || '#3B82F6',
                        pointBorderWidth: 3,
                        pointRadius: 8,
                        pointHoverRadius: 12,
                        pointHoverBorderWidth: 4,
                        tension: 0.4,
                        fill: true,
                        shadowColor: 'rgba(0,0,0,0.1)',
                        shadowBlur: 15,
                        shadowOffsetY: 8,
                    }
                ];
                
                // Add budget line if data exists
                if (data.some(item => item.budget !== undefined)) {
                    datasets.push({
                        label: 'Budget',
                        data: data.map(item => item.budget || 0),
                        borderColor: '#9CA3AF',
                        backgroundColor: 'transparent',
                        borderWidth: 3,
                        borderDash: [8, 4],
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#9CA3AF',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 9,
                        pointHoverBorderWidth: 3,
                        tension: 0.4,
                        fill: false
                    });
                }
                
                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(item => item.month || item.name),
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    padding: 25,
                                    font: {
                                        size: 12,
                                        weight: '600'
                                    },
                                    color: '#374151'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: color || '#3B82F6',
                                borderWidth: 2,
                                cornerRadius: 12,
                                displayColors: true,
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 13 },
                                padding: 12,
                                callbacks: {
                                    afterLabel: function(context) {
                                        if (context.datasetIndex === 0 && data[context.dataIndex].budget) {
                                            const actual = data[context.dataIndex].actual || 0;
                                            const budget = data[context.dataIndex].budget;
                                            const variance = ((actual / budget - 1) * 100).toFixed(1);
                                            return `Variance: ${variance}%`;
                                        }
                                        return '';
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)',
                                    drawBorder: false,
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    },
                                    color: '#6B7280',
                                    font: { size: 11 }
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.1)',
                                    drawBorder: false,
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: { size: 11, weight: '500' }
                                }
                            }
                        },
                        animation: {
                            duration: 1500,
                            easing: 'easeInOutQuart'
                        },
                        elements: {
                            point: {
                                hoverBorderWidth: 4
                            }
                        }
                    }
                });
                
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [data, color]);
            
            if (!data || data.length === 0) {
                return React.createElement('div', {
                    className: 'flex items-center justify-center h-full text-gray-500'
                }, 'No data available');
            }
            
            return React.createElement('canvas', {
                ref: chartRef,
                style: { maxHeight: '350px' }
            });
        }
        
         function MultiLineChart({ data, title }) {
            const chartRef = React.useRef(null);
            const chartInstance = React.useRef(null);
            
            React.useEffect(() => {
                if (!data || data.length === 0 || !chartRef.current) return;
                
                // Destroy existing chart
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }
                
                const ctx = chartRef.current.getContext('2d');
                
                // Create gradients for each line
                const tBillsGradient = ctx.createLinearGradient(0, 0, 0, 400);
                tBillsGradient.addColorStop(0, '#3B82F640');
                tBillsGradient.addColorStop(1, '#3B82F605');
                
                const outrightGradient = ctx.createLinearGradient(0, 0, 0, 400);
                outrightGradient.addColorStop(0, '#10B98140');
                outrightGradient.addColorStop(1, '#10B98105');
                
                const govSecGradient = ctx.createLinearGradient(0, 0, 0, 400);
                govSecGradient.addColorStop(0, '#F59E0B40');
                govSecGradient.addColorStop(1, '#F59E0B05');
                
                const datasets = [
                    {
                        label: 'T-Bills',
                        data: data.map(item => item.tBills || 0),
                        borderColor: '#3B82F6',
                        backgroundColor: tBillsGradient,
                        borderWidth: 3,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#3B82F6',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointHoverBorderWidth: 3,
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Outright Sale',
                        data: data.map(item => item.outrightSale || 0),
                        borderColor: '#10B981',
                        backgroundColor: outrightGradient,
                        borderWidth: 3,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#10B981',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointHoverBorderWidth: 3,
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Gov Securities',
                        data: data.map(item => item.govSecurities || 0),
                        borderColor: '#F59E0B',
                        backgroundColor: govSecGradient,
                        borderWidth: 3,
                        pointBackgroundColor: '#ffffff',
                        pointBorderColor: '#F59E0B',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointHoverBorderWidth: 3,
                        tension: 0.4,
                        fill: true
                    }
                ];
                
                chartInstance.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(item => item.month || item.name),
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: {
                                        size: 12,
                                        weight: '600'
                                    },
                                    color: '#374151'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: '#3B82F6',
                                borderWidth: 2,
                                cornerRadius: 12,
                                displayColors: true,
                                titleFont: { size: 14, weight: 'bold' },
                                bodyFont: { size: 13 },
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label}: ${context.raw.toLocaleString()}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)',
                                    drawBorder: false,
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toLocaleString();
                                    },
                                    color: '#6B7280',
                                    font: { size: 11 }
                                }
                            },
                            x: {
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.1)',
                                    drawBorder: false,
                                },
                                ticks: {
                                    color: '#6B7280',
                                    font: { size: 11, weight: '500' }
                                }
                            }
                        },
                        animation: {
                            duration: 1500,
                            easing: 'easeInOutQuart'
                        },
                        elements: {
                            point: {
                                hoverBorderWidth: 4
                            }
                        }
                    }
                });
                
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [data, title]);
            
            if (!data || data.length === 0) {
                return React.createElement('div', {
                    className: 'flex items-center justify-center h-full text-gray-500'
                }, 'No data available');
            }
            
            return React.createElement('canvas', {
                ref: chartRef,
                style: { maxHeight: '350px' }
            });
        }
        
        function GroupedBarChart({ data, title }) {
            const chartRef = React.useRef(null);
            const chartInstance = React.useRef(null);
            
            React.useEffect(() => {
                if (!data || data.length === 0 || !chartRef.current) return;
                
                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }
                
                const ctx = chartRef.current.getContext('2d');
                
                const junGradient = ctx.createLinearGradient(0, 0, 0, 400);
                junGradient.addColorStop(0, '#3B82F6');
                junGradient.addColorStop(1, '#3B82F680');
                
                const julGradient = ctx.createLinearGradient(0, 0, 0, 400);
                julGradient.addColorStop(0, '#10B981');
                julGradient.addColorStop(1, '#10B98180');
                
                const augGradient = ctx.createLinearGradient(0, 0, 0, 400);
                augGradient.addColorStop(0, '#F59E0B');
                augGradient.addColorStop(1, '#F59E0B80');
                
                chartInstance.current = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.map(item => `${item.icon || 'ðŸ“Š'} ${item.shortLabel || item.category}`),
                        datasets: [
                            {
                                label: data[0]?.month1Label || 'Month 1',
                                data: data.map(item => item.month1 || item.jun || 0),
                                backgroundColor: junGradient,
                                borderColor: '#3B82F6',
                                borderWidth: 2,
                                borderRadius: 6,
                                borderSkipped: false,
                                barThickness: 'flex',
                                maxBarThickness: 30
                            },
                            {
                                label: data[0]?.month2Label || 'Month 2',
                                data: data.map(item => item.month2 || item.jul || 0),
                                backgroundColor: julGradient,
                                borderColor: '#10B981',
                                borderWidth: 2,
                                borderRadius: 6,
                                borderSkipped: false,
                                barThickness: 'flex',
                                maxBarThickness: 30
                            },
                            {
                                label: data[0]?.month3Label || 'Month 3',
                                data: data.map(item => item.month3 || item.aug || 0),
                                backgroundColor: augGradient,
                                borderColor: '#F59E0B',
                                borderWidth: 2,
                                borderRadius: 6,
                                borderSkipped: false,
                                barThickness: 'flex',
                                maxBarThickness: 30
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false,
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 20,
                                    font: { size: 12, weight: '600' },
                                    color: '#374151'
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(17, 24, 39, 0.95)',
                                titleColor: 'white',
                                bodyColor: 'white',
                                borderColor: '#3B82F6',
                                borderWidth: 2,
                                cornerRadius: 12,
                                titleFont: { size: 13, weight: 'bold' },
                                bodyFont: { size: 12 },
                                padding: 12,
                                callbacks: {
                                    label: function(context) {
                                        const value = context.raw;
                                        const formatted = Math.abs(value) >= 1000 ? 
                                            (value/1000).toFixed(1) + 'K' : 
                                            value.toLocaleString();
                                        return `${context.dataset.label}: ${formatted}`;
                                    },
                                    title: function(context) {
                                        return context[0].label;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                min: -1000,
                                max: 10000,
                                grid: {
                                    color: 'rgba(156, 163, 175, 0.2)',
                                    drawBorder: false,
                                },
                                ticks: {
                                     stepSize: 1000,
                                    callback: function(value) {
                                        return Math.abs(value) >= 1000 ? 
                                            (value).toFixed(0) + 'Mn' : 
                                            value.toLocaleString();
                                    },
                                    color: '#6B7280',
                                    font: { size: 10 }
                                }
                            },
                            x: {
                                grid: { display: false },
                                ticks: {
                                    color: '#6B7280',
                                    font: { size: 9, weight: '500' },
                                    maxRotation: 25,
                                    minRotation: 0
                                }
                            }
                        },
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuart'
                        }
                    }
                });
                
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [data, title]);
            
            if (!data || data.length === 0) {
                return React.createElement('div', {
                    className: 'flex items-center justify-center h-full text-gray-500'
                }, 'No data available');
            }
            
            return React.createElement('canvas', {
                ref: chartRef,
                style: { maxHeight: '400px' }
            });
        }

        function Dashboard({ user, logout }) {
            const [data, setData] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [selectedEntity, setSelectedEntity] = useState('janashakthi-limited');
            const [selectedMonth, setSelectedMonth] = useState('June');
            const [selectedYear, setSelectedYear] = useState('2025');
            const [showLogin, setShowLogin] = useState(false);
            const [showUpload, setShowUpload] = useState(false);
            const [password, setPassword] = useState('');
            const [authToken, setAuthToken] = useState(null);
            const [uploadFile, setUploadFile] = useState(null);
            const [uploadLoading, setUploadLoading] = useState(false);
            const [showAdminPanel, setShowAdminPanel] = useState(false);
            const [uploadEntity, setUploadEntity] = useState('janashakthi-limited');
            const [uploadMonth, setUploadMonth] = useState('June');
            const [uploadYear, setUploadYear] = useState('2025');

            const getBusinessActivityValue = (data, metricName, monthIndex) => {
                console.log('ðŸ” Getting value for:', metricName, 'month index:', monthIndex);
                console.log('ðŸ“Š Available data:', data?.businessActivity);
                if (!data?.businessActivity?.metrics) {
                    console.log('âŒ No business activity data found');
                    return '0';
                }
                const metricKey = Object.keys(data.businessActivity.metrics).find(key =>
                    key.toLowerCase().includes(metricName.toLowerCase())
                );

                if (!metricKey) {
                    console.log(`âŒ Metric not found: ${metricName}`);
                    console.log('ðŸ“‹ Available metrics:', Object.keys(data.businessActivity.metrics));
                    return '0';
                }

                const metric = data.businessActivity.metrics[metricKey];
                console.log(`âœ… Found metric ${metricKey}:`, metric);

                let value;
                switch(monthIndex) {
                    case 0: value = metric.month1; break;
                    case 1: value = metric.month2; break;
                    case 2: value = metric.month3; break;
                    default: value = 0;
                }

                return typeof value === 'number' ? value.toLocaleString() : '0';
            };

            const entities = [
                {
                    id: 'janashakthi-limited', 
                    name: 'Janashakthi Limited', 
                    short: 'JXG', 
                    color: '#EA580C',
                    logo: '/images/janashakthi-limited-logo.png.png'
                },
                {
                    id: 'janashakthi-insurance', 
                    name: 'Janashakthi Insurance PLC', 
                    short: 'JINS', 
                    color: '#A16207',
                    logo: '/images/janashakthi-insurance-logo.png.jpg'
                },
                {
                    id: 'first-capital', 
                    name: 'First Capital Holdings PLC', 
                    short: 'FCH', 
                    color: '#1E3A8A',
                    logo: '/images/first-capital-logo.png.jpg'
                },
                {
                    id: 'janashakthi-finance', 
                    name: 'Janashakthi Finance PLC', 
                    short: 'JF', 
                    color: '#92400E',
                    logo: '/images/janashakthi-finance-logo.png.jpg'
                }
                
            ];

            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const years = ['2023', '2024', '2025', '2026', '2027'];

            const janashakthiLimitedNoBudgetKPIs = [
                'Debt to Equity Ratio',
                'ROE Annualized', 
                'Total Assets',
                'Equity',
                'Staff Count'
            ];

            const loadData = async () => {
                try {
                    const token = localStorage.getItem('authToken');
                    const response = await fetch('/api/dashboard-data', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    const result = await response.json();
                    setData(result);
                    setError(null);
                } catch (err) {
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleAdminLogin = async () => {
                try {
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ password })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        setAuthToken(result.token);
                        setShowLogin(false);
                        setShowAdminPanel(true);
                        setPassword('');
                    } else {
                        alert('âŒ Wrong password. Try: admin123');
                    }
                } catch (error) {
                    alert('âŒ Login failed');
                }
            };

            const handleAdminFileUpload = async () => {
                const token = localStorage.getItem('authToken');
                if (!uploadFile || !token) return;

                setUploadLoading(true);
                try {
                    const formData = new FormData();
                    formData.append('dataFile', uploadFile);
                    formData.append('entityId', uploadEntity);
                    formData.append('month', uploadMonth);
                    formData.append('year', uploadYear);

                    const token = localStorage.getItem('authToken');
                    const response = await fetch('/api/upload', {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${token}` },
                        body: formData
                    });

                    if (response.ok) {
                        const result = await response.json();
                        alert('âœ… ' + result.message);
                        setUploadFile(null);
                        loadData();
                    } else {
                        const error = await response.json();
                        alert('âŒ Upload failed: ' + error.error);
                    }
                } catch (error) {
                    alert('âŒ Upload failed: ' + error.message);
                } finally {
                    setUploadLoading(false);
                }
            };

            const downloadTemplate = async (entityId) => {
                try {
                    const entity = entities.find(e => e.id === entityId);
                    const token = localStorage.getItem('authToken');
        
                    const response = await fetch(`/api/template/${entityId}`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    });
        
                    if (response.ok) {
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `${entity.short}_Template_${new Date().toISOString().slice(0,10)}.xlsx`;
                        link.click();
                        window.URL.revokeObjectURL(url);
                    } else {
                        alert('Failed to download template. Admin access required.');
                    }
                } catch (error) {
                    alert('Error downloading template: ' + error.message);
                }
            };

            const currentEntity = entities.find(e => e.id === selectedEntity);
            const periodKey = `${selectedMonth}-${selectedYear}`;
            const currentData = data && data[periodKey] && data[periodKey][selectedEntity];

            const chartData = useMemo(() => {
                // Add safety checks for currentData and kpis
                if (!currentData || !currentData.kpis || !Array.isArray(currentData.kpis)) {
                    console.warn('No valid currentData or KPIs found');
                    return null;
                }

                // Financial Composition - Key financial KPIs with safety checks
                const financialData = currentData.kpis.filter(kpi => {
                    // Safety check: ensure kpi and kpi.name exist before calling toLowerCase
                    if (!kpi || !kpi.name || typeof kpi.name !== 'string') {
                        console.warn('Invalid KPI object:', kpi);
                        return false;
                    }
        
                    const name = kpi.name.toLowerCase();
                    return name.includes('pat') || 
                        name.includes('assets') || 
                        name.includes('equity') || 
                        name.includes('profit') ||
                        name.includes('liabilities') ||
                        name.includes('nav');
                }).slice(0, 4).map((kpi, index) => ({
                    name: kpi.name || 'Unknown KPI',
                    value: kpi.actual || 0,
                    color: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444'][index]
                }));

                // Entity-specific chart data from uploaded data
                let entitySpecificData = {};

                if (selectedEntity === 'janashakthi-limited') {
                    // Use actual uploaded data if available, otherwise fallback to sample
                    const shareComposition = currentData.shareComposition || [
                        { name: 'Janashakthi Insurance PLC', value: 100, color: '#8B5CF6' },
                        { name: 'First Capital Holdings PLC', value: 100, color: '#06B6D4' },
                        { name: 'Janashakthi Finance PLC', value: 100, color: '#10B981' }
                    ];

                    const overheadsData = currentData.overheads || [
                        { name: 'Staff Cost', actual: 100, budget: 80 },
                        { name: 'Admin Cost', actual: 100, budget: 100 },
                        { name: 'Marketing', actual: 80, budget: 100 },
                        { name: 'Professional Charges', actual: 60, budget: 100 }
                    ];

                    const wacdData = currentData.wacdMovement || [
                        { month: '24-Aug', actual: 35, budget: 20 },
                        { month: '24-Sep', actual: 20, budget: 15 },
                        { month: '24-Oct', actual: 20, budget: 15 }
                    ];

                    const maturityProfile = currentData.maturityProfile || [
                        { name: '0-3 Months', value: 40 },
                        { name: '3-6 Months', value: 60 },
                        { name: '6-12 Months', value: 80 },
                        { name: '1-2 Years', value: 55 },
                        { name: '3-6 Years', value: 35 }
                    ];

                    entitySpecificData = { shareComposition, overheadsData, wacdData, maturityProfile };
                }

                if (selectedEntity === 'janashakthi-insurance') {
                    entitySpecificData = {
                        retailBusinessFYP: currentData.retailBusinessFYP || [],
                        jsvFYP: currentData.jsvFYP || [],
                        dtaFYP: currentData.dtaFYP || [],
                        renewalPremium: currentData.renewalPremium || [],
                        ulCreditRating: currentData.ulCreditRating || [],
                        surplusActual: currentData.surplusActual || []
                    };
                }

                if (selectedEntity === 'first-capital') {
                    console.log('=== DEBUG: First Capital Data ===', currentData);
                    console.log('=== All Available Fields ===', Object.keys(currentData || {}));
                    const netIncomeData = currentData.netIncomeAgainstBudget || [
                        { month: '25-Jun', actual: 100, budget: 80 },
                        { month: '25-Jul', actual: 80, budget: 100 },
                        { month: '25-Aug', actual: 100, budget: 100 }
                    ];

                    const tradingComposition = currentData.tradingComposition || [
                        { name: 'Primary Dealing', value: 100, color: '#8B5CF6' },
                        { name: 'Dealing Securities', value: 100, color: '#06B6D4' },
                        { name: 'Corporate Finance', value: 80, color: '#10B981' },
                        { name: 'Asset Management', value: 70, color: '#F59E0B' },
                        { name: 'Stock Brokering', value: 60, color: '#EF4444' }
                    ];

                    const overheadsData = currentData.overheadsAgainstBudget || [
                        { name: 'Staff Cost', actual: 100, budget: 80 },
                        { name: 'Admin Cost', actual: 100, budget: 100 },
                        { name: 'Marketing', actual: 80, budget: 100 },
                        { name: 'Professional Charges', actual: 60, budget: 100 }
                    ];

                    const unitTrustAUM = currentData.unitTrustAUM || [
                        { month: '25-Jun', actual: 73000, budget: 70000 },
                        { month: '25-Jul', actual: 73000, budget: 70000 },
                        { month: '25-Aug', actual: 73000, budget: 70000 }
                    ];

                    const wmAUM = currentData.wmAUM || [
                        { month: '25-Jun', actual: 73000, budget: 70000 },
                        { month: '25-Jul', actual: 73000, budget: 70000 },
                        { month: '25-Aug', actual: 73000, budget: 70000 }
                    ];

                    const portfolioManagement = currentData.portfolioManagement || [
                        { month: '25-Jun', actual: 36000 },
                        { month: '25-Jul', actual: 38000 },
                        { month: '25-Aug', actual: 40000 }
                    ];

                    const treasuriesData = currentData.treasuriesData || [
                        { month: 'Jun-25', tBills: 26000, outrightSale: 50000, govSecurities: 80000 },
                        { month: 'Jul-25', tBills: 30000, outrightSale: 60000, govSecurities: 85000 },
                        { month: 'Aug-25', tBills: 40000, outrightSale: 7000, govSecurities: 80000 }
                    ];

                    const treasuriesChartData = [];
                    if (treasuriesData && treasuriesData.length > 0) {
                        treasuriesData.forEach(item => {
                            treasuriesChartData.push({
                                month: item.month,
                                tBills: item.tBills || 0,
                                outrightSale: item.outrightSale || 0,
                                govSecurities: item.govSecurities || 0
                            });
                        });
                    }

                    const dealingSecuritiesData = currentData.dealingSecurities || [
                        { 
                            category: 'Investment in Corporate & Gov Debts', 
                            shortLabel: 'Corp & Gov Debt Investment',
                            icon: 'ðŸ›ï¸',
                            jun: 5000, jul: 4500, aug: 6000 
                        },
                        { 
                            category: 'MTM Gain/Loss on Corporate & Gov. Debts', 
                            shortLabel: 'Corp & Gov Debt MTM',
                            icon: 'ðŸ“Š',
                            jun: -32, jul: -27, aug: 32 
                        },
                        { 
                            category: 'Investment in Listed Equity Securities FVTPL', 
                            shortLabel: 'Listed Equity FVTPL',
                            icon: 'ðŸ“ˆ',
                            jun: 5000, jul: 5000, aug: 5000 
                        },
                        { 
                            category: 'MTM Gain/Loss on Listed Equity Securities FVTPL', 
                            shortLabel: 'Listed Equity FVTPL MTM',
                            icon: 'ðŸ’¹',
                            jun: 3500, jul: 3500, aug: 3500 
                        },
                        { 
                            category: 'Investment in Listed Equity Securities FVTOCI', 
                            shortLabel: 'Listed Equity FVTOCI',
                            icon: 'ðŸ“‰',
                            jun: 2500, jul: 2500, aug: 2500 
                        },
                        { 
                            category: 'MTM Gain/Loss on Listed Equity Securities FVTOCI', 
                            shortLabel: 'Listed Equity FVTOCI MTM',
                            icon: 'ðŸŽ¯',
                            jun: 73, jul: 73, aug: 73 
                        },
                        { 
                            category: 'Value of Debt Mandates executed for the Month', 
                            shortLabel: 'Monthly Debt Mandates',
                            icon: 'ðŸ“‹',
                            jun: 10, jul: 10, aug: 10 
                        }
                    ];

                    entitySpecificData = { netIncomeData, tradingComposition, overheadsData, unitTrustAUM, wmAUM, portfolioManagement, treasuriesChartData, dealingSecuritiesData };
                }

                if (selectedEntity === 'janashakthi-finance') {
                    const netInterestIncome = currentData.netInterestIncomeAgainstBudget || [
                        { month: '25-Jun', actual: 100, budget: 80 },
                        { month: '25-Jul', actual: 80, budget: 100 },
                        { month: '25-Aug', actual: 100, budget: 100 }
                    ];

                    const loanComposition = currentData.loanComposition || [
                        { name: 'Factoring', value: 100, color: '#8B5CF6' },
                        { name: 'Gold Loans', value: 100, color: '#06B6D4' },
                        { name: 'Leasing', value: 80, color: '#10B981' },
                        { name: 'Loans', value: 70, color: '#F59E0B' },
                        { name: 'Ijara', value: 60, color: '#EF4444' }
                    ];

                    const overheadsData = currentData.overheadsAgainstBudget || [
                        { name: 'Staff Cost', actual: 100, budget: 80 },
                        { name: 'Admin Cost', actual: 100, budget: 100 },
                        { name: 'Marketing', actual: 80, budget: 100 },
                        { name: 'Professional Charges', actual: 60, budget: 100 }
                    ];

                    entitySpecificData = { netInterestIncome, loanComposition, overheadsData };
                }

                return { financialData, entitySpecificData };
            }, [currentData, selectedEntity]);

            
             useEffect(() => {
                loadData();
            }, []);

            useEffect(() => {
                if (!currentData && data) {
                    const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                    const years = ['2023', '2024', '2025', '2026', '2027'];
                    const currentMonthIndex = months.indexOf(selectedMonth);
                    const currentYearIndex = years.indexOf(selectedYear);
                        
                    let foundPrevious = false;

                    for (let i = currentMonthIndex - 1; i >= 0 && !foundPrevious; i--) {
                        const checkKey = `${months[i]}-${selectedYear}`;
                        if (data[checkKey] && data[checkKey][selectedEntity]) {
                            setSelectedMonth(months[i]);
                            foundPrevious = true;
                            break;
                        }
                    }

                    if (!foundPrevious) {
                        for (let y = currentYearIndex - 1; y >= 0 && !foundPrevious; y--) {
                            for (let i = months.length - 1; i >= 0; i--) {
                                const checkKey = `${months[i]}-${years[y]}`;
                                if (data[checkKey] && data[checkKey][selectedEntity]) {
                                    setSelectedMonth(months[i]);
                                    setSelectedYear(years[y]);
                                    foundPrevious = true;
                                    break;
                                }
                            }
                        }
                    }
                }
            }, [selectedEntity, selectedMonth, selectedYear, data, currentData]);

            if (!currentData) {
                return React.createElement('div', {
                    className: 'min-h-screen bg-gray-100 flex items-center justify-center'
                }, React.createElement('div', {
                    className: 'text-center'
                }, [
                    React.createElement('h2', {
                        key: 'title',
                        className: 'text-xl font-bold text-gray-900 mb-2'
                    }, 'No Data Available'),
                    React.createElement('p', {
                        key: 'message',
                        className: 'text-gray-600'
                    }, `No data found for ${currentEntity.name} in ${selectedMonth} ${selectedYear}`)
                ]));
            }

            if (loading) {
                return React.createElement('div', {
                    className: 'min-h-screen bg-gray-100 flex items-center justify-center'
                }, React.createElement('div', {
                    className: 'text-center'
                }, [
                    React.createElement('div', {
                        key: 'spinner',
                        className: 'w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full spin mx-auto mb-4'
                    }),
                    React.createElement('h2', {
                        key: 'title',
                        className: 'text-xl font-bold text-gray-900 mb-2'
                    }, 'Loading Dashboard'),
                    React.createElement('p', {
                        key: 'subtitle',
                        className: 'text-gray-600'
                    }, 'Fetching your financial data...')
                ]));
            }

            if (error) {
                return React.createElement('div', {
                    className: 'min-h-screen bg-gray-100 flex items-center justify-center'
                }, React.createElement('div', {
                    className: 'text-center max-w-md mx-auto'
                }, [
                    React.createElement('h2', {
                        key: 'title',
                        className: 'text-xl font-bold text-gray-900 mb-2'
                    }, 'Connection Error'),
                    React.createElement('p', {
                        key: 'message',
                        className: 'text-gray-600 mb-4'
                    }, `Error: ${error}`),
                    React.createElement('button', {
                        key: 'retry',
                        onClick: loadData,
                        className: 'bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700'
                    }, 'Try Again')
                ]));
            }

           

            return React.createElement('div', {
                className: 'min-h-screen bg-gray-100 flex'
            }, [
                // Admin Login Modal
                showLogin && React.createElement('div', {
                    key: 'login-modal',
                    className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50'
                }, React.createElement('div', {
                    className: 'bg-white rounded-lg p-6 max-w-md w-full mx-4'
                }, [
                    React.createElement('h3', {
                        key: 'title',
                        className: 'text-lg font-bold mb-4'
                    }, 'ðŸ” Admin Sign In'),
                    React.createElement('input', {
                        key: 'input',
                        type: 'password',
                        value: password,
                        onChange: (e) => setPassword(e.target.value),
                        onKeyPress: (e) => e.key === 'Enter' && handleAdminLogin(),
                        placeholder: 'Enter admin password',
                        className: 'w-full border border-gray-300 rounded-lg px-4 py-3 mb-4'
                    }),
                    React.createElement('div', {
                        key: 'buttons',
                        className: 'flex gap-3'
                    }, [
                        React.createElement('button', {
                            key: 'login',
                            onClick: handleAdminLogin,
                            className: 'flex-1 btn-primary text-white py-3 rounded-lg'
                        }, 'Sign In'),
                        React.createElement('button', {
                            key: 'cancel',
                            onClick: () => setShowLogin(false),
                            className: 'flex-1 bg-gray-600 text-white py-3 rounded-lg'
                        }, 'Cancel')
                    ])
                ])),

                // Admin Panel Modal
                showAdminPanel && React.createElement('div', {
                    key: 'admin-panel',
                    className: 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50'
                }, React.createElement('div', {
                    className: 'bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto'
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: 'flex items-center justify-between mb-6'
                    }, [
                        React.createElement('h3', {
                            key: 'title',
                            className: 'text-xl font-bold text-gray-900'
                        }, 'âš™ï¸ Admin Panel'),
                        React.createElement('button', {
                            key: 'close',
                            onClick: () => setShowAdminPanel(false),
                            className: 'text-gray-500 hover:text-gray-700'
                        }, 'âœ•')
                    ]),

                    // Template Downloads Section
                    React.createElement('div', {
                        key: 'templates-section',
                        className: 'mb-8'
                    }, [
                        React.createElement('h4', {
                            key: 'title',
                            className: 'text-lg font-semibold text-gray-800 mb-4'
                        }, 'ðŸ“‹ Download Templates'),
                        React.createElement('div', {
                            key: 'template-grid',
                            className: 'grid grid-cols-1 md:grid-cols-2 gap-4'
                        }, entities.map(entity => React.createElement('div', {
                            key: entity.id,
                            className: 'border border-gray-200 rounded-lg p-4'
                        }, [
                            React.createElement('div', {
                                key: 'entity-info',
                                className: 'flex items-center gap-3 mb-3'
                            }, [
                                React.createElement('div', {
                                    key: 'icon',
                                    className: 'w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold text-sm',
                                    style: { backgroundColor: entity.color }
                                }, entity.short),
                                React.createElement('div', {
                                    key: 'details'
                                }, [
                                    React.createElement('h5', {
                                        key: 'name',
                                        className: 'font-medium text-gray-900'
                                    }, entity.name),
                                    React.createElement('p', {
                                        key: 'desc',
                                        className: 'text-sm text-gray-500'
                                    }, entity.description || 'Financial Entity')
                                ])
                            ]),

                            React.createElement('button', {
                                key: 'download-btn',
                                onClick: () => downloadTemplate(entity.id),
                                className: 'w-full bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors'
                            }, `Download ${entity.short} Template`)
                        ])))
                    ]),

                    // Upload Section
                    React.createElement('div', {
                        key: 'upload-section',
                        className: 'border-t pt-6'
                    }, [
                        React.createElement('h4', {
                            key: 'title',
                            className: 'text-lg font-semibold text-gray-800 mb-4'
                        }, 'ðŸ“¤ Upload Data'),
                        React.createElement('div', {
                            key: 'upload-form',
                            className: 'grid grid-cols-1 md:grid-cols-3 gap-4 mb-4'
                        }, [
                            React.createElement('div', {
                                key: 'entity-select'
                            }, [
                                React.createElement('label', {
                                    key: 'label',
                                    className: 'block text-sm font-medium text-gray-700 mb-2'
                                }, 'Company'),
                                React.createElement('select', {
                                    key: 'select',
                                    value: uploadEntity,
                                    onChange: (e) => setUploadEntity(e.target.value),
                                    className: 'w-full border border-gray-300 rounded-lg px-3 py-2'
                                }, entities.map(entity => React.createElement('option', {
                                    key: entity.id,
                                    value: entity.id
                                }, `${entity.short} - ${entity.name}`)))
                            ]),

                            React.createElement('div', {
                                key: 'month-select'
                            }, [
                                React.createElement('label', {
                                    key: 'label',
                                    className: 'block text-sm font-medium text-gray-700 mb-2'
                                }, 'Month'),
                                React.createElement('select', {
                                    key: 'select',
                                    value: uploadMonth,
                                    onChange: (e) => setUploadMonth(e.target.value),
                                    className: 'w-full border border-gray-300 rounded-lg px-3 py-2'
                                }, months.map(month => React.createElement('option', {
                                    key: month,
                                    value: month
                                }, month)))
                            ]),
                            React.createElement('div', {
                                key: 'year-select'
                            }, [
                                React.createElement('label', {
                                    key: 'label',
                                    className: 'block text-sm font-medium text-gray-700 mb-2'
                                }, 'Year'),
                                React.createElement('select', {
                                    key: 'select',
                                    value: uploadYear,
                                    onChange: (e) => setUploadYear(e.target.value),
                                    className: 'w-full border border-gray-300 rounded-lg px-3 py-2'
                                }, years.map(year => React.createElement('option', {
                                    key: year,
                                    value: year
                                }, year)))
                            ])
                        ]),
                        React.createElement('div', {
                            key: 'file-upload',
                            className: 'mb-4'
                        }, [
                            React.createElement('label', {
                                key: 'label',
                                className: 'block text-sm font-medium text-gray-700 mb-2'
                            }, 'Excel File'),
                            React.createElement('input', {
                                key: 'file',
                                type: 'file',
                                accept: '.xlsx,.xls,.csv',
                                onChange: (e) => setUploadFile(e.target.files[0]),
                                className: 'w-full border border-gray-300 rounded-lg px-3 py-2'
                            })
                        ]),
                        React.createElement('div', {
                            key: 'upload-actions',
                            className: 'flex gap-3'
                        }, [
                            React.createElement('button', {
                                key: 'upload',
                                onClick: handleAdminFileUpload,
                                disabled: !uploadFile || uploadLoading,
                                className: 'flex-1 bg-blue-600 text-white py-3 px-6 rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed'
                            }, uploadLoading ? 'Uploading...' : 'Upload Data'),
                            React.createElement('button', {
                                key: 'cancel',
                                onClick: () => {
                                    setShowAdminPanel(false);
                                    setUploadFile(null);
                                },
                                className: 'px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50'
                            }, 'Close')
                        ])
                    ]),

                    React.createElement('div', {
                        key: 'export-section',
                        className: 'border-t pt-6'
                    }, [
                        React.createElement('h4', {
                            key: 'title',
                            className: 'text-lg font-semibold text-gray-800 mb-4'
                        }, 'ðŸ“Š Database Export'),
                        React.createElement('p', {
                            key: 'description',
                            className: 'text-gray-600 mb-4'
                        }, 'Download a comprehensive Excel report of all data in the database for debugging.'),
                        React.createElement('button', {
                            key: 'export-db',
                            onClick: async () => {
                                try {
                                    const token = localStorage.getItem('authToken');
                                    const response = await fetch('/api/export/database-report', {
                                        headers: { 'Authorization': `Bearer ${token}` }
                                    });
                
                                    if (response.ok) {
                                        const blob = await response.blob();
                                        const url = window.URL.createObjectURL(blob);
                                        const link = document.createElement('a');
                                        link.href = url;
                                        link.download = `Database_Export_${new Date().toISOString().slice(0,10)}.xlsx`;
                                        link.click();
                                        window.URL.revokeObjectURL(url);
                                    } else {
                                        alert('Failed to download database export');
                                    }
                                } catch (error) {
                                    alert('Error downloading export: ' + error.message);
                                }
                            },
                            className: 'bg-green-600 text-white py-3 px-6 rounded-lg hover:bg-green-700 transition-colors'
                        }, 'Download Database Report'),

                        React.createElement('button', {
                            key: 'cleanup-duplicates',
                            onClick: async () => {
                                if (confirm('This will permanently remove ALL duplicate KPIs and chart data entries. Continue?')) {
                                    try {
                                        const token = localStorage.getItem('authToken');
                                        const response = await fetch('/api/admin/cleanup-duplicates', {
                                            method: 'POST',
                                            headers: { 
                                                'Authorization': `Bearer ${token}`,
                                                'Content-Type': 'application/json'
                                            }
                                        });
                
                                        if (response.ok) {
                                            const result = await response.json();
                                            alert(`Cleanup completed successfully!\nRemoved: ${result.deletedEntries} duplicates\nRemaining: ${result.remaining.kpis} KPIs, ${result.remaining.chartData} chart entries`);
                                        } else {
                                            const error = await response.json();
                                            alert(`Cleanup failed: ${error.error}`);
                                        }
                                    } catch (error) {
                                        alert('Cleanup failed: ' + error.message);
                                    }
                                }
                            },
                            className: 'bg-red-600 text-white py-3 px-6 rounded-lg hover:bg-red-700 transition-colors mt-4'
                        }, 'Clean Up ALL Duplicates (KPIs + Charts)')
                    ])

                    // End of admin panel sections
                ])),

                

                           
                // Sidebar
                React.createElement('div', {
                    key: 'sidebar',
                    className: 'w-80 bg-white shadow-lg border-r border-gray-200 flex flex-col'
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: 'p-4 border-b'
                    }, [
                        React.createElement('h1', {
                            key: 'title',
                            className: 'text-xl font-bold text-gray-900'
                        }, 'Janashakthi Group'),
                        React.createElement('p', {
                            key: 'subtitle',
                            className: 'text-sm text-gray-500'
                        }, 'Financial Dashboard'),
                        React.createElement('p', {
                            key: 'username',
                            className: 'text-xs text-gray-400 mt-1'
                        }, `Welcome, ${user.name}`)
                    ]),
                    React.createElement('div', {
                        key: 'user-info',
                        className: 'p-4 border-b bg-gray-50'
                    }, [
                        React.createElement('div', {
                            key: 'user-details',
                            className: 'flex items-center justify-between'
                        }, [
                            React.createElement('div', { key: 'info' }, [
                                React.createElement('p', {
                                    key: 'email',
                                    className: 'text-sm font-medium text-gray-900'
                                }, user.email),
                                React.createElement('p', {
                                    key: 'role',
                                    className: 'text-xs text-gray-500'
                                }, `Role: ${user.role}`)
                            ]),
                            React.createElement('button', {
                                key: 'logout',
                                onClick: logout,
                                className: 'text-sm text-red-600 hover:text-red-800'
                            }, 'Logout')
                        ])
                    ]),

                    React.createElement('div', {
                        key: 'period',
                        className: 'p-4 border-b'
                    }, [
                        React.createElement('h3', {
                            key: 'title',
                            className: 'text-sm font-bold text-gray-700 mb-3'
                        }, 'ðŸ“… Period'),
                        React.createElement('select', {
                            key: 'month',
                            value: selectedMonth,
                            onChange: (e) => setSelectedMonth(e.target.value),
                            className: 'w-full border border-gray-300 rounded px-2 py-1 mb-2 text-sm'
                        }, months.map(month => React.createElement('option', {
                            key: month,
                            value: month
                        }, month))),
                        React.createElement('select', {
                            key: 'year',
                            value: selectedYear,
                            onChange: (e) => setSelectedYear(e.target.value),
                            className: 'w-full border border-gray-300 rounded px-2 py-1 text-sm'
                        }, years.map(year => React.createElement('option', {
                            key: year,
                            value: year
                        }, year)))
                    ]),
                    React.createElement('div', {
                        key: 'entities',
                        className: 'flex-1 p-4'
                    }, [
                        React.createElement('h3', {
                            key: 'title',
                            className: 'text-sm font-bold text-gray-700 mb-3'
                        }, 'ðŸ¢ Companies'),
                        React.createElement('div', {
                            key: 'list',
                            className: 'space-y-2'
                        }, entities.map(entity => React.createElement('button', {
                            key: entity.id,
                            onClick: () => setSelectedEntity(entity.id),
                            className: `w-full text-left p-3 rounded-lg transition-all nav-item ${
                                selectedEntity === entity.id ? 'text-white shadow-lg' : 'text-gray-700 hover:bg-gray-50'
                            }`,
                            style: {
                                backgroundColor: selectedEntity === entity.id ? entity.color : undefined
                            }
                        }, React.createElement('div', {
                            className: 'flex items-center gap-3'
                        }, [
                            entity.logo ? 
                            React.createElement('img', {
                                key: 'nav-logo',
                                src: entity.logo,
                                alt: entity.name,
                                className: 'w-10 h-10 rounded-lg object-contain bg-white p-1 shadow-sm'
                            }) : 
                            React.createElement('div', {
                                key: 'nav-fallback',
                                className: 'w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold text-xs',
                                style: { backgroundColor: entity.color }
                            }, entity.short),
                            React.createElement('p', {
                                key: 'name',
                                className: 'font-medium text-sm'
                            }, entity.name)
                        ]))))
                    ])
                ]),

                // Main Content
                React.createElement('div', {
                    key: 'main',
                    className: 'flex-1'
                }, [
                    React.createElement('div', {
                        key: 'header',
                        className: 'bg-gradient-to-r from-blue-50 to-indigo-50 shadow-lg'
                    }, React.createElement('div', {
                        className: 'px-6 py-6'
                    }, React.createElement('div', {
                        className: 'flex items-center justify-between'
                    }, [
                        React.createElement('div', {
                            key: 'info',
                            className: 'flex items-center space-x-4'
                        }, [
                            React.createElement('div', {
                                key: 'logo',
                                className: 'w-20 h-20 rounded-lg object-contain'
                            }, [
                                currentEntity.logo && React.createElement('img', {
                                    key: 'logo-img',
                                    src: currentEntity.logo,
                                    alt: currentEntity.name,
                                    className: 'w-full h-full object-contain p-1',
                                    onError: function(e) {
                                        // Hide image and show fallback div
                                        e.target.style.display = 'none';
                                        e.target.parentNode.querySelector('.fallback-logo').style.display = 'flex';
                                    }
                                }),
                                React.createElement('div', {
                                    key: 'fallback',
                                    className: 'fallback-logo w-full h-full flex items-center justify-center text-white font-bold text-lg',
                                    style: { 
                                        backgroundColor: currentEntity.color,
                                        display: currentEntity.logo ? 'none' : 'flex'
                                    }
                                }, currentEntity.short)
                            ]),

                            React.createElement('div', {
                                key: 'details'
                            }, [
                                React.createElement('h1', {
                                    key: 'name',
                                    className: 'text-2xl font-bold text-gray-900'
                                }, currentEntity.name),
                                React.createElement('p', {
                                    key: 'period',
                                    className: 'text-sm text-gray-500'
                                }, `${selectedMonth} ${selectedYear}`)
                            ])
                        ]),
                        user.role === 'admin' && React.createElement('div', {
                            key: 'actions',
                            className: 'flex gap-3'
                        }, [
                            React.createElement('button', {
                                key: 'admin',
                                onClick: () => setShowAdminPanel(true),
                                className: 'btn-primary text-white px-4 py-2 rounded-lg'
                            }, 'Admin Panel')
                        ])
                    ]))),

                    // Dashboard Content
                    React.createElement('div', {
                        key: 'content',
                        className: 'p-6'
                    }, [
                        // KPI Cards Grid
                        React.createElement('div', {
                            key: 'kpi-grid',
                            className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8'
                        }, currentData.kpis && currentData.kpis.map((kpi, index) => React.createElement('div', {
                            key: index,
                            className: 'kpi-card rounded-2xl p-6 relative overflow-hidden'
                        }, [
                            // Background Pattern
                            React.createElement('div', {
                                key: 'bg',
                                className: 'absolute top-0 right-0 w-32 h-32 opacity-5'
                            }, React.createElement('div', {
                                className: 'w-full h-full rounded-full',
                                style: { backgroundColor: currentEntity.color }
                            })),
                            
                            // Header
                            React.createElement('div', {
                                key: 'header',
                                className: 'flex items-start justify-between mb-6'
                            }, [
                                React.createElement('div', {
                                    key: 'title-section',
                                    className: 'flex-1 pr-4'
                                }, React.createElement('h3', {
                                    className: 'text-sm font-semibold text-slate-600 leading-tight mb-1'
                                }, kpi.name)),
                                
                                // Unit in top right corner
                                kpi.unit && React.createElement('div', {
                                    key: 'unit',
                                    className: 'kpi-unit bg-slate-100 px-2 py-1 rounded-lg'
                                }, kpi.unit)
                            ]),
                            
                            // Main Value
                            React.createElement('div', {
                                key: 'main-value',
                                className: 'mb-4'
                            }, [
                                React.createElement('div', {
                                    key: 'value',
                                    className: 'kpi-value mb-1'
                                }, (kpi.actual || 0).toLocaleString()),
                                React.createElement('div', {
                                    key: 'label',
                                    className: 'text-xs font-medium text-slate-500 uppercase tracking-wide'
                                }, 'Actual')
                            ]),
                            
                            // Budget and Variance
                            kpi.budget && !janashakthiLimitedNoBudgetKPIs.includes(kpi.name) && React.createElement('div', {
                                key: 'budget-section',
                                className: 'space-y-3'
                            }, [
                                // Budget Value
                                React.createElement('div', {
                                    key: 'budget-row',
                                    className: 'flex items-center justify-between py-2 px-3 bg-slate-50 rounded-lg'
                                }, [
                                    React.createElement('span', {
                                        key: 'budget-label',
                                        className: 'text-xs font-medium text-slate-500 uppercase tracking-wide'
                                    }, 'Budget'),
                                    React.createElement('span', {
                                        key: 'budget-value',
                                        className: 'kpi-budget'
                                    }, kpi.budget.toLocaleString())
                                ]),
                                
                                // Variance Indicator
                                React.createElement('div', {
                                    key: 'variance-row',
                                    className: 'flex items-center justify-between'
                                }, [
                                    React.createElement('span', {
                                        key: 'variance-label',
                                        className: 'text-xs font-medium text-slate-500 uppercase tracking-wide'
                                    }, 'Variance'),
                                    React.createElement('div', {
                                        key: 'variance-value',
                                        className: `flex items-center space-x-1 px-2 py-1 rounded-full text-xs font-bold ${
                                            (kpi.actual || 0) >= (kpi.budget || 0) 
                                                ? 'bg-emerald-100 text-emerald-700' 
                                                : 'bg-red-100 text-red-700'
                                        }`
                                    }, [
                                        React.createElement('span', {
                                            key: 'arrow'
                                        }, (kpi.actual || 0) >= (kpi.budget || 0) ? 'â†—' : 'â†˜'),
                                        React.createElement('span', {
                                            key: 'percentage'
                                        }, `${kpi.budget ? (((kpi.actual || 0) / kpi.budget - 1) * 100).toFixed(1) : 0}%`)
                                    ])
                                ])
                            ])
                        ]))),

                        // Charts Section - Financial Composition Only
                        React.createElement('div', {
                            key: 'charts',
                            className: 'grid grid-cols-1 gap-6 mb-8'
                        }, [
                        ]),

                        // Entity-Specific Charts
                        selectedEntity === 'janashakthi-limited' && React.createElement('div', {
                            key: 'jxg-charts',
                            className: 'space-y-6'
                        }, [
                            React.createElement('div', {
                                key: 'row1',
                                className: 'grid grid-cols-1 lg:grid-cols-2 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'share-composition',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'ðŸ¢ Share of Profit Composition'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimplePieChart, {
                                        data: chartData.entitySpecificData?.shareComposition || [
                                            { name: 'Janashakthi Insurance PLC', value: 100, color: '#8B5CF6' },
                                            { name: 'First Capital Holdings PLC', value: 100, color: '#06B6D4' },
                                            { name: 'Janashakthi Finance PLC', value: 100, color: '#10B981' }
                                        ]
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'overheads',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'ðŸ“ˆ Overheads vs Budget'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleBarChart, {
                                        data: chartData.entitySpecificData?.overheadsData || [
                                            { name: 'Staff Cost', actual: 100, budget: 80 },
                                            { name: 'Admin Cost', actual: 100, budget: 100 },
                                            { name: 'Marketing', actual: 80, budget: 100 },
                                            { name: 'Professional Charges', actual: 60, budget: 100 }
                                        ],
                                        color: currentEntity.color
                                    }))
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'row2',
                                className: 'grid grid-cols-1 lg:grid-cols-2 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'maturity',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'ðŸ“Š Maturity Profile'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleBarChart, {
                                        data: (chartData.entitySpecificData?.maturityProfile || [
                                        { name: '0-3 Months', value: 40 },
                                        { name: '3-6 Months', value: 60 },
                                        { name: '6-12 Months', value: 80 },
                                        { name: '1-2 Years', value: 55 },
                                        { name: '3-6 Years', value: 35 }
                                        ]).map(period => ({ name: period.name, actual: period.value })),
                                        color: currentEntity.color,
                                        hideLegend: true
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'wacd-awplr',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'WACD vs AWPLR'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData.entitySpecificData?.wacdData || [
                                            { month: '24-Aug', actual: 35, budget: 20 },
                                            { month: '24-Sep', actual: 20, budget: 15 },
                                            { month: '24-Oct', actual: 20, budget: 15 },
                                            { month: '24-Nov', actual: 20, budget: 15 },
                                            { month: '24-Dec', actual: 20, budget: 15 }
                                        ],
                                        color: currentEntity.color
                                    }))
                                ])
                            ])
                        ]),

                        // Janashakthi Insurance Charts
                        selectedEntity === 'janashakthi-insurance' && React.createElement('div', {
                            key: 'jins-charts',
                            className: 'space-y-6'
                        }, [
                            React.createElement('div', {
                                key: 'row1',
                                className: 'grid grid-cols-1 lg:grid-cols-3 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'retail',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Retail Business FYP'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData?.entitySpecificData?.retailBusinessFYP || [],
                                        color: "#8B5CF6"
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'jsv',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'JSV FYP'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData?.entitySpecificData?.jsvFYP || [],
                                        color: "#06B6D4"
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'dta',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'DTA FYP'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData?.entitySpecificData?.dtaFYP || [],
                                        color: "#10B981"
                                    }))
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'row2',
                                className: 'grid grid-cols-1 lg:grid-cols-3 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'renewal',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Renewal Premium'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData?.entitySpecificData?.renewalPremium || [],
                                        color: "#F59E0B"
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'ul',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'UL Credit Rating Vs UL Fund Yield'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData?.entitySpecificData?.ulCreditRating || [],
                                        color: "#EF4444"
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'surplus',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Surplus Actual Vs Budget'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData?.entitySpecificData?.surplusActual || [],
                                        color: "#8B5CF6"
                                    }))
                                ])
                            ])
                        ]),

                        // First Capital Charts
                        selectedEntity === 'first-capital' && React.createElement('div', {
                            key: 'fch-charts',
                            className: 'space-y-6'
                        }, [
                            React.createElement('div', {
                                key: 'row1',
                                className: 'grid grid-cols-1 lg:grid-cols-2 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'net-income',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Net Income against Budget'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData.entitySpecificData?.netIncomeData || [
                                            { month: '25-Jun', actual: 100, budget: 80 },
                                            { month: '25-Jul', actual: 80, budget: 100 },
                                            { month: '25-Aug', actual: 100, budget: 100 }
                                        ],
                                        color: "#1E3A8A"
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'trading',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Net Trading Composition'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimplePieChart, {
                                        data: chartData.entitySpecificData?.tradingComposition || [
                                            { name: 'Primary Dealing', value: 100, color: '#8B5CF6' },
                                            { name: 'Dealing Securities', value: 100, color: '#06B6D4' },
                                            { name: 'Corporate Finance', value: 80, color: '#10B981' },
                                            { name: 'Asset Management', value: 70, color: '#F59E0B' },
                                            { name: 'Stock Brokering', value: 60, color: '#EF4444' }
                                        ]
                                    }))
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'row2',
                                className: 'grid grid-cols-1 lg:grid-cols-2 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'overheads',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Overheads against Budget'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleBarChart, {
                                        data: chartData.entitySpecificData?.overheadsData || [
                                            { name: 'Staff Cost', actual: 100, budget: 80 },
                                            { name: 'Admin Cost', actual: 100, budget: 100 },
                                            { name: 'Marketing', actual: 80, budget: 100 },
                                            { name: 'Professional Charges', actual: 60, budget: 100 }
                                        ],
                                        color: "#1E3A8A"
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'unit-trust',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Unit Trust AUM'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData.entitySpecificData?.unitTrustAUM || [
                                            { month: '25-Jun', actual: 73000, budget: 70000 },
                                            { month: '25-Jul', actual: 73000, budget: 70000 },
                                            { month: '25-Aug', actual: 73000, budget: 70000 }
                                        ],
                                        color: "#06B6D4"
                                    }))
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'row3',
                                className: 'grid grid-cols-1 lg:grid-cols-2 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'wm-aum',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'WM AUM'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData.entitySpecificData?.wmAUM || [
                                            { month: '25-Jun', actual: 73000, budget: 70000 },
                                            { month: '25-Jul', actual: 73000, budget: 70000 },
                                            { month: '25-Aug', actual: 73000, budget: 70000 }
                                        ],
                                        color: "#10B981"
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'treasuries',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'First Capital Treasuries'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(MultiLineChart, {
                                       data: chartData.entitySpecificData?.treasuriesChartData || [
                                        { month: 'Jun-25', tBills: 26000, outrightSale: 50000, govSecurities: 80000 },
                                        { month: 'Jul-25', tBills: 30000, outrightSale: 60000, govSecurities: 85000 },
                                        { month: 'Aug-25', tBills: 40000, outrightSale: 7000, govSecurities: 80000 }
                                        ],
                                        title: 'Treasuries'
                                    }))
                                ])    
                            ]),
                            React.createElement('div', {
                                key: 'dealing-securities',
                                className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                            }, [
                                React.createElement('h3', {
                                    key: 'title',
                                    className: 'text-lg font-bold text-gray-900 mb-4'
                                }, 'Dealing Securities & Corporate Finance'),
                                React.createElement('div', {
                                    key: 'chart',
                                    className: 'h-96'
                                }, React.createElement(GroupedBarChart, {
                                    data: chartData.entitySpecificData?.dealingSecuritiesData || [
                                        {
                                            category: 'Investment in Corporate & Gov Debts',
                                            shortLabel: 'Corp & Gov Debt Investment',
                                            icon: 'ðŸ›ï¸',
                                            jun: 5000, jul: 4500, aug: 6000
                                        },
                                        {
                                            category: 'MTM Gain/Loss on Corporate & Gov. Debts',
                                            shortLabel: 'Corp & Gov Debt MTM',
                                            icon: 'ðŸ“Š',
                                            jun: -32, jul: -27, aug: 32
                                        },
                                        {
                                            category: 'Investment in Listed Equity Securities FVTPL',
                                            shortLabel: 'Listed Equity FVTPL',
                                            icon: 'ðŸ“ˆ',
                                            jun: 5000, jul: 5000, aug: 5000 
                                        },
                                        {
                                            category: 'MTM Gain/Loss on Listed Equity Securities FVTPL',
                                            shortLabel: 'Listed Equity FVTPL MTM',
                                            icon: 'ðŸ’¹',
                                            jun: 3500, jul: 3500, aug: 3500 
                                        },
                                        {
                                            category: 'Investment in Listed Equity Securities FVTOCI',
                                            shortLabel: 'Listed Equity FVTOCI',
                                            icon: 'ðŸ“‰',
                                            jun: 2500, jul: 2500, aug: 2500 
                                        },
                                        {
                                            category: 'MTM Gain/Loss on Listed Equity Securities FVTOCI',
                                            shortLabel: 'Listed Equity FVTOCI MTM',
                                            icon: 'ðŸŽ¯',
                                            jun: 73, jul: 73, aug: 73 
                                        },
                                        {
                                            category: 'Value of Debt Mandates executed for the Month',
                                            shortLabel: 'Monthly Debt Mandates',
                                            icon: 'ðŸ“‹',
                                            jun: 10, jul: 10, aug: 10 
                                        }
                                    ],
                                    title: 'Dealing Securities'
                                }))
                            ]),
                            React.createElement('div', {
                                key: 'row4',
                                className: 'grid grid-cols-1 lg:grid-cols-2 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'equities',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'FCE\'s Market Turnover'),
                                    React.createElement('div', {
                                        key: 'table-container',
                                        className: 'h-64 overflow-auto'
                                    }, React.createElement('table', {
                                        className: 'w-full text-sm'
                                    }, [
                                        React.createElement('thead', {
                                            key: 'header',
                                            className: 'bg-gray-50 sticky top-0'
                                        }, React.createElement('tr', {}, [
                                            React.createElement('th', {
                                                key: 'metric',
                                                className: 'text-left p-3 font-semibold text-gray-700 border-b border-gray-200'
                                            }, 'Metric'),
                                            React.createElement('th', {
                                                key: 'jun',
                                                className: 'text-center p-3 font-semibold text-gray-700 border-b border-gray-200'
                                            }, currentData.fceMarketTurnover?.headers?.month1 || '25-Jun'),
                                            React.createElement('th', {
                                                key: 'jul',
                                                className: 'text-center p-3 font-semibold text-gray-700 border-b border-gray-200'
                                            }, currentData.fceMarketTurnover?.headers?.month2 || '25-Jul'),
                                            React.createElement('th', {
                                                key: 'aug',
                                                className: 'text-center p-3 font-semibly text-gray-700 border-b border-gray-200'
                                            }, currentData.fceMarketTurnover?.headers?.month3 || '25-Aug')
                                        ])),

                                        React.createElement('tbody', {
                                            key: 'body'
                                        }, [
                                            React.createElement('tr', {
                                                key: 'volume',
                                                className: 'hover:bg-gray-50 transition-colors'
                                            }, [
                                                React.createElement('td', {
                                                    key: 'label',
                                                    className: 'p-3 font-medium text-gray-900 border-b border-gray-100'
                                                }, [
                                                    React.createElement('div', {
                                                        className: 'flex items-center gap-2'
                                                    }, [
                                                        React.createElement('div', {
                                                            key: 'indicator',
                                                            className: 'w-3 h-3 rounded-full',
                                                            style: { backgroundColor: '#1E3A8A' }
                                                        }),
                                                        React.createElement('span', {
                                                            key: 'text'
                                                        }, 'Volume %')
                                                    ])
                                                ]),

                                                React.createElement('td', {
                                                    key: 'jun-vol',
                                                    className: 'p-3 text-center font-semibold text-blue-600 border-b border-gray-100'
                                                }, (currentData.fceMarketTurnover?.jun?.volume) || '4.36%'),
                                                React.createElement('td', {
                                                    key: 'jul-vol',
                                                    className: 'p-3 text-center font-semibold text-blue-600 border-b border-gray-100'
                                                }, (currentData.fceMarketTurnover?.jul?.volume) || '4.20%'),
                                                React.createElement('td', {
                                                    key: 'aug-vol',
                                                    className: 'p-3 text-center font-semibold text-blue-600 border-b border-gray-100'
                                                }, (currentData.fceMarketTurnover?.aug?.volume) || '4.30%')
                                            ]),

                                            React.createElement('tr', {
                                                key: 'commission',
                                                className: 'hover:bg-gray-50 transition-colors'
                                            }, [
                                                React.createElement('td', {
                                                    key: 'label',
                                                    className: 'p-3 font-medium text-gray-900 border-b border-gray-100'
                                                }, [
                                                    React.createElement('div', {
                                                        className: 'flex items-center gap-2'
                                                    }, [
                                                        React.createElement('div', {
                                                            key: 'indicator',
                                                            className: 'w-3 h-3 rounded-full',
                                                            style: { backgroundColor: '#10B981' }
                                                        }),
                                                        React.createElement('span', {
                                                            key: 'text'
                                                        }, 'Commission %')
                                                    ])
                                                ]),

                                                React.createElement('td', {
                                                    key: 'jun-com',
                                                    className: 'p-3 text-center font-semibold text-green-600 border-b border-gray-100'
                                                }, (currentData.fceMarketTurnover?.jun?.commission) || '4.0%'),
                                                React.createElement('td', {
                                                    key: 'jul-com',
                                                    className: 'p-3 text-center font-semibold text-green-600 border-b border-gray-100'
                                                }, (currentData.fceMarketTurnover?.jul?.commission) || '3.0%'),
                                                React.createElement('td', {
                                                    key: 'aug-com',
                                                    className: 'p-3 text-center font-semibold text-green-600 border-b border-gray-100'
                                                }, (currentData.fceMarketTurnover?.aug?.commission) || '2.90%')
                                            ])
                                        ])
                                    ]))      
                                ]),
                                React.createElement('div', {
                                    key: 'portfolio',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Portfolio Management'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData.entitySpecificData?.portfolioManagement || [
                                            { month: '25-Jun', actual: 36000 },
                                            { month: '25-Jul', actual: 38000 },
                                            { month: '25-Aug', actual: 40000 }
                                        ],
                                        color: "#F59E0B"
                                    }))
                                ])
                            ])
                        ]),

                        // Janashakthi Finance Charts
                        selectedEntity === 'janashakthi-finance' && React.createElement('div', {
                            key: 'jf-charts',
                            className: 'space-y-6'
                        }, [
                            React.createElement('div', {
                                key: 'row1',
                                className: 'grid grid-cols-1 lg:grid-cols-2 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'net-interest',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Net Interest Income against Budget'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleLineChart, {
                                        data: chartData.entitySpecificData?.netInterestIncome || [
                                            { month: '25-Jun', actual: 100, budget: 80 },
                                            { month: '25-Jul', actual: 80, budget: 100 },
                                            { month: '25-Aug', actual: 100, budget: 100 }
                                        ],
                                        color: "#92400E"
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'loan-composition',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Loan & Receivable from Customers'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimplePieChart, {
                                        data: chartData.entitySpecificData?.loanComposition || [
                                            { name: 'Factoring', value: 100, color: '#8B5CF6' },
                                            { name: 'Gold Loans', value: 100, color: '#06B6D4' },
                                            { name: 'Leasing', value: 80, color: '#10B981' },
                                            { name: 'Loans', value: 70, color: '#F59E0B' },
                                            { name: 'Ijara', value: 60, color: '#EF4444' }
                                        ]
                                    }))
                                ])
                            ]),
                            React.createElement('div', {
                                key: 'row2',
                                className: 'grid grid-cols-1 lg:grid-cols-2 gap-6'
                            }, [
                                React.createElement('div', {
                                    key: 'overheads',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'ðŸ“Š Overheads against Budget'),
                                    React.createElement('div', {
                                        key: 'chart',
                                        className: 'h-64'
                                    }, React.createElement(SimpleBarChart, {
                                        data: chartData.entitySpecificData?.overheadsData || [
                                            { name: 'Staff Cost', actual: 100, budget: 80 },
                                            { name: 'Admin Cost', actual: 100, budget: 100 },
                                            { name: 'Marketing', actual: 80, budget: 100 },
                                            { name: 'Professional Charges', actual: 60, budget: 100 }
                                        ],
                                        color: "#92400E"
                                    }))
                                ]),
                                React.createElement('div', {
                                    key: 'business-activity',
                                    className: 'bg-white rounded-xl shadow-lg p-6 border border-gray-100'
                                }, [
                                    React.createElement('h3', {
                                        key: 'title',
                                        className: 'text-lg font-bold text-gray-900 mb-4'
                                    }, 'Business Activity'),
                                    React.createElement('div', {
                                        key: 'table-container',
                                        className: 'h-64 overflow-auto'
                                    }, React.createElement('table', {
                                        className: 'w-full text-sm'
                                    }, [
                                        React.createElement('thead', {
                                            key: 'header',
                                            className: 'bg-gray-50 sticky top-0'
                                        }, React.createElement('tr', {}, [
                                            React.createElement('th', {
                                                key: 'metric',
                                                className: 'text-left p-3 font-semibold text-gray-700 border-b border-gray-200'
                                            }, 'Metric'),
                                            React.createElement('th', {
                                                key: 'month1',
                                                className: 'text-center p-3 font-semibold text-gray-700 border-b border-gray-200'
                                            }, currentData.businessActivity?.headers?.month1 || '25-Jun'),
                                            React.createElement('th', {
                                                key: 'month2', 
                                                className: 'text-center p-3 font-semibold text-gray-700 border-b border-gray-200'
                                            }, currentData.businessActivity?.headers?.month2 || '25-Jul'),
                                            React.createElement('th', {
                                                key: 'month3',
                                                className: 'text-center p-3 font-semibold text-gray-700 border-b border-gray-200'
                                            }, currentData.businessActivity?.headers?.month3 || '25-Aug')
                                        ])),

                                        React.createElement('tbody', {
                                            key: 'body'
                                        }, [
                                            React.createElement('tr', {
                                                key: 'new-fds',
                                                className: 'hover:bg-gray-50 transition-colors'
                                            }, [
                                                React.createElement('td', {
                                                    key: 'label',
                                                    className: 'p-3 font-medium text-gray-900 border-b border-gray-100'
                                                }, [
                                                    React.createElement('div', {
                                                        className: 'flex items-center gap-2'
                                                    }, [
                                                        React.createElement('div', {
                                                            key: 'indicator',
                                                            className: 'w-3 h-3 rounded-full',
                                                            style: { backgroundColor: '#92400E' }
                                                        }),
                                                        React.createElement('span', {
                                                            key: 'text'
                                                        }, 'New FDs')
                                                    ])
                                                ]),
                                                React.createElement('td', {
                                                    key: 'jun-val',
                                                    className: 'p-3 text-center font-semibold text-amber-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'New FDs', 0)),
                                                React.createElement('td', {
                                                    key: 'jul-val',
                                                    className: 'p-3 text-center font-semibold text-amber-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'New FDs', 1)),
                                                React.createElement('td', {
                                                    key: 'aug-val',
                                                    className: 'p-3 text-center font-semibold text-amber-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'New FDs', 2))
                                            ]),

                                            React.createElement('tr', {
                                                key: 'fds-withdrawn',
                                                className: 'hover:bg-gray-50 transition-colors'
                                            }, [
                                                React.createElement('td', {
                                                    key: 'label',
                                                    className: 'p-3 font-medium text-gray-900 border-b border-gray-100'
                                                }, [
                                                    React.createElement('div', {
                                                        className: 'flex items-center gap-2'
                                                    }, [
                                                        React.createElement('div', {
                                                            key: 'indicator',
                                                            className: 'w-3 h-3 rounded-full',
                                                            style: { backgroundColor: '#DC2626' }
                                                        }),
                                                        React.createElement('span', {
                                                            key: 'text'
                                                        }, 'FDs Withdrawn')
                                                    ])
                                                ]),
                                                React.createElement('td', {
                                                    key: 'jun-val',
                                                    className: 'p-3 text-center font-semibold text-red-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'FDs Withdrawn', 0)),
                                                React.createElement('td', {
                                                    key: 'jul-val',
                                                    className: 'p-3 text-center font-semibold text-red-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'FDs Withdrawn', 1)),
                                                React.createElement('td', {
                                                    key: 'aug-val',
                                                    className: 'p-3 text-center font-semibold text-red-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'FDs Withdrawn', 2))
                                            ]),
                                            React.createElement('tr', {
                                                key: 'other-loans',
                                                className: 'hover:bg-gray-50 transition-colors'
                                            }, [
                                                React.createElement('td', {
                                                    key: 'label',
                                                    className: 'p-3 font-medium text-gray-900 border-b border-gray-100'
                                                }, [
                                                    React.createElement('div', {
                                                        className: 'flex items-center gap-2'
                                                    }, [
                                                        React.createElement('div', {
                                                            key: 'indicator',
                                                            className: 'w-3 h-3 rounded-full',
                                                            style: { backgroundColor: '#059669' }
                                                        }),
                                                        React.createElement('span', {
                                                            key: 'text'
                                                        }, 'Other Loans')
                                                    ])
                                                ]),
                                                React.createElement('td', {
                                                    key: 'jun-val',
                                                    className: 'p-3 text-center font-semibold text-green-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'Other Loans', 0)),
                                                React.createElement('td', {
                                                    key: 'jul-val',
                                                    className: 'p-3 text-center font-semibold text-green-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'Other Loans', 1)),
                                                React.createElement('td', {
                                                    key: 'aug-val',
                                                    className: 'p-3 text-center font-semibold text-green-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'Other Loans', 2))
                                            ]),
                                            React.createElement('tr', {
                                                key: 'gold-loans',
                                                className: 'hover:bg-gray-50 transition-colors'
                                            }, [
                                                React.createElement('td', {
                                                    key: 'label',
                                                    className: 'p-3 font-medium text-gray-900 border-b border-gray-100'
                                                }, [
                                                    React.createElement('div', {
                                                        className: 'flex items-center gap-2'
                                                    }, [
                                                        React.createElement('div', {
                                                            key: 'indicator',
                                                            className: 'w-3 h-3 rounded-full',
                                                            style: { backgroundColor: '#D97706' }
                                                        }),
                                                        React.createElement('span', {
                                                            key: 'text'
                                                        }, 'Gold Loans')
                                                    ])
                                                ]),
                                                React.createElement('td', {
                                                    key: 'jun-val',
                                                    className: 'p-3 text-center font-semibold text-orange-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'Gold Loans', 0)),
                                                React.createElement('td', {
                                                    key: 'jul-val',
                                                    className: 'p-3 text-center font-semibold text-orange-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'Gold Loans', 1)),
                                                React.createElement('td', {
                                                    key: 'aug-val',
                                                    className: 'p-3 text-center font-semibold text-orange-600 border-b border-gray-100'
                                                }, getBusinessActivityValue(currentData, 'Gold Loans', 2))
                                            ])
                                        ])
                                    ]))
                                ])
                                
                            ])
                        ])
                    ])
                ])
            ]);
        }

        // Main App Component
        function App() {
            const { authState, login, register, logout } = useAuth();

            // Loading state - shows while checking if user is logged in
            if (authState.isLoading) {
                return React.createElement('div', {
                    style: { 
                        display: 'flex', 
                        justifyContent: 'center', 
                        alignItems: 'center', 
                        height: '100vh', 
                        background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)' 
                    }
                }, React.createElement('div', {
                    style: { textAlign: 'center', color: 'white' }
                }, [
                    React.createElement('div', {
                        key: 'spinner',
                        style: { 
                            width: '64px', 
                            height: '64px', 
                            border: '4px solid #ffffff', 
                            borderTop: '4px solid transparent', 
                            borderRadius: '50%', 
                            animation: 'spin 1s linear infinite', 
                            margin: '0 auto 16px' 
                        }
                    }),
                    React.createElement('h2', {
                        key: 'title',
                        style: { fontSize: '24px', fontWeight: 'bold', marginBottom: '8px' }
                    }, 'Loading Janashakthi Dashboard'),
                    React.createElement('p', {
                        key: 'subtitle',
                        style: { opacity: 0.8 }
                    }, 'Initializing secure authentication...')
                ]));
            }

            // If user is not authenticated, show login/register form
            if (!authState.isAuthenticated) {
                return React.createElement(AuthComponent, { authState, login, register });
            }

            // If user is authenticated, show the dashboard
            return React.createElement(Dashboard, { user: authState.user, logout });
        }

        // Render the App (instead of Dashboard directly)
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>